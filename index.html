<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Did√°ctica de Costes y Beneficios para Escritoras</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

    <!-- Estilos CSS Incrustados -->
    <style>
        /* --- Estilos Base (como antes) --- */
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f4f7f6;
            color: #333;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }
        .container {
            background-color: #fff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            width: 100%;
            box-sizing: border-box;
        }
        h1 { text-align: center; color: #2c3e50; margin-bottom: 30px; font-weight: 600; }
        h2 { color: #34495e; border-bottom: 2px solid #e0e0e0; padding-bottom: 10px; margin-top: 30px; margin-bottom: 20px; }
        .mode-selector { text-align: center; margin-bottom: 20px; }
        .mode-selector label { font-weight: 600; margin-right: 10px; }
        select, input[type="number"], button#calculateBtn /* Select only calculate button */ {
            width: 100%;
            padding: 10px 12px;
            margin-bottom: 15px; /* Reduced margin for inputs */
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
            font-size: 16px;
            font-family: 'Poppins', sans-serif;
            transition: border-color 0.3s ease;
        }
        input[type="number"]:focus, select:focus { border-color: #3498db; outline: none; }
        button#calculateBtn {
            background-color: #3498db;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s ease;
            margin-top: 20px; /* Add margin top to separate from last input */
        }
        button#calculateBtn:hover { background-color: #2980b9; }
        .input-group { margin-bottom: 5px; /* Reduced margin */ } /* Reduce gap between label/input and explanation */
        .input-group label { display: block; margin-bottom: 3px; font-weight: 400; color: #555; }
        .input-sections { border-radius: 8px; overflow: hidden; }
        .mode-section, .common-costs { background-color: #f9f9f9; padding: 20px; margin-bottom: 20px; border-radius: 8px; border: 1px solid #eee; }
        .mode-section.hidden { display: none; }
        fieldset { border: 1px solid #ddd; border-radius: 6px; padding: 15px; margin-bottom: 20px; }
        legend { font-weight: 600; color: #34495e; padding: 0 10px; margin-bottom: 10px; background-color: #f9f9f9; border-radius: 4px; }
        .results-section { background-color: #ecf0f1; padding: 20px; border-radius: 8px; margin-top: 30px; border: 1px solid #bdc3c7; }
        .results-section p { margin: 10px 0; font-size: 1.1em; font-weight: 400; color: #2c3e50; }
        .results-section p strong { font-weight: 600; color: #2980b9; }
        .results-section hr { border: 0; border-top: 1px dashed #bdc3c7; margin: 15px 0; }

        /* --- Nuevos Estilos para Explicaciones Desplegables --- */
        .label-group {
            display: flex;
            align-items: center;
            margin-bottom: 3px; /* Space between label+button and input */
        }
        .label-group label {
            margin-bottom: 0; /* Remove default label margin */
            margin-right: 8px; /* Space between label and button */
            flex-grow: 1; /* Allow label to take available space */
        }
        .info-toggle {
            background-color: #bdc3c7;
            color: white;
            border: none;
            border-radius: 50%;
            width: 22px;
            height: 22px;
            font-size: 14px;
            font-weight: bold;
            line-height: 22px; /* Center the '?' vertically */
            text-align: center;
            cursor: pointer;
            padding: 0;
            flex-shrink: 0; /* Prevent button from shrinking */
            transition: background-color 0.3s ease;
            margin-left: auto; /* Pushes button to the right if label is short */
        }
        .info-toggle:hover { background-color: #95a5a6; }
        .info-toggle[aria-expanded="true"] { background-color: #3498db; } /* Indicate open state */

        .info-details {
            background-color: #eaf2f8; /* Light blue background */
            border: 1px solid #aed6f1;
            border-radius: 4px;
            padding: 10px 15px;
            margin-top: 5px; /* Space between input and explanation */
            margin-bottom: 15px; /* Space before next input group */
            font-size: 0.9em;
            color: #283747;
            /* Animation */
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-out, padding 0.4s ease-out, margin-top 0.4s ease-out, margin-bottom 0.4s ease-out;
        }
        .info-details[hidden] {
             /* Use JS to remove 'hidden', CSS handles the transition */
             padding-top: 0;
             padding-bottom: 0;
             margin-top: 0;
             margin-bottom: 0;
             border-width: 0;
        }
        .info-details:not([hidden]) {
            /* State when visible */
            max-height: 500px; /* Adjust as needed, large enough for content */
             /* Re-apply padding/margin when not hidden */
            padding: 10px 15px;
            margin-top: 5px;
            margin-bottom: 15px;
            border-width: 1px;
        }
        .info-details p {
            margin: 5px 0;
            line-height: 1.5;
        }
        .info-details strong { color: #2980b9; } /* Highlight term within explanation */

        /* Responsive adjustments */
        @media (max-width: 600px) {
            .container { padding: 15px; }
            h1 { font-size: 1.5em; }
            select, input[type="number"], button#calculateBtn { font-size: 14px; padding: 8px 10px; }
            .info-toggle { width: 20px; height: 20px; line-height: 20px; font-size: 12px; }
            .info-details { font-size: 0.85em; }
        }
    </style>
    <!-- Fin de Estilos CSS -->
</head>
<body>
    <div class="container">
        <h1>üìö Calculadora Did√°ctica de Costes y Beneficios</h1>
        <p style="text-align: center; margin-top: -20px; margin-bottom: 25px;">Haz clic en los botones ‚ùî para ver la explicaci√≥n de cada campo.</p>

        <div class="mode-selector">
            <label for="modeSelect">Selecciona el Modo:</label>
            <select id="modeSelect">
                <option value="kdp">Amazon KDP (Print & eBook)</option>
                <option value="traditional">Imprenta Tradicional</option>
            </select>
        </div>

        <div class="input-sections">
            <!-- Secci√≥n KDP -->
            <div id="kdpSection" class="mode-section">
                <h2>Amazon KDP (Print & eBook)</h2>

                <fieldset>
                    <legend>Detalles del Libro (Print)</legend>

                    <div class="input-group">
                        <div class="label-group">
                            <label for="kdpListPricePrint">Precio de Venta (Impreso) (‚Ç¨):</label>
                            <button class="info-toggle" aria-expanded="false" aria-controls="info-kdpListPricePrint" title="Mostrar/Ocultar explicaci√≥n">?</button>
                        </div>
                        <input type="number" id="kdpListPricePrint" value="15.00" step="0.01" min="0">
                        <div class="info-details" id="info-kdpListPricePrint" hidden>
                            <p><strong>Precio de Venta (Impreso):</strong> Es el precio que pagar√° el cliente final por tu libro en formato f√≠sico en Amazon. Este precio influye directamente en tu royalty (beneficio por libro).</p>
                            <p>KDP tiene precios m√≠nimos basados en el coste de impresi√≥n.</p>
                        </div>
                    </div>

                     <div class="input-group">
                        <div class="label-group">
                            <label for="kdpPages">N√∫mero de P√°ginas:</label>
                            <button class="info-toggle" aria-expanded="false" aria-controls="info-kdpPages" title="Mostrar/Ocultar explicaci√≥n">?</button>
                        </div>
                        <input type="number" id="kdpPages" value="300" min="24">
                         <div class="info-details" id="info-kdpPages" hidden>
                            <p><strong>N√∫mero de P√°ginas:</strong> El total de p√°ginas de tu libro maquetado. Es un factor clave para calcular el coste de impresi√≥n en KDP (m√°s p√°ginas = mayor coste).</p>
                             <p>KDP requiere un m√≠nimo de 24 p√°ginas para libros impresos.</p>
                        </div>
                    </div>

                    <div class="input-group">
                         <div class="label-group">
                             <label for="kdpInk">Tipo de Tinta:</label>
                             <button class="info-toggle" aria-expanded="false" aria-controls="info-kdpInk" title="Mostrar/Ocultar explicaci√≥n">?</button>
                        </div>
                        <select id="kdpInk">
                            <option value="bw">Blanco y Negro</option>
                            <option value="color_standard">Color Est√°ndar</option>
                            <option value="color_premium">Color Premium</option>
                        </select>
                         <div class="info-details" id="info-kdpInk" hidden>
                            <p><strong>Tipo de Tinta:</strong> Define si el interior del libro se imprime en blanco y negro o a color.</p>
                            <ul>
                                <li><strong>Blanco y Negro:</strong> Opci√≥n m√°s econ√≥mica, ideal para novelas y libros de texto sin im√°genes a color.</li>
                                <li><strong>Color Est√°ndar:</strong> M√°s caro que B/N. Buena calidad para libros con gr√°ficos o im√°genes, como infantiles o de no ficci√≥n ilustrados. Papel espec√≠fico.</li>
                                <li><strong>Color Premium:</strong> La opci√≥n m√°s cara. Mayor calidad de color y papel m√°s grueso, ideal para libros de fotograf√≠a o arte.</li>
                            </ul>
                            <p>El tipo de tinta afecta significativamente el coste de impresi√≥n.</p>
                        </div>
                    </div>

                     <div class="input-group">
                         <div class="label-group">
                             <label for="kdpPaper">Tipo de Papel:</label>
                            <button class="info-toggle" aria-expanded="false" aria-controls="info-kdpPaper" title="Mostrar/Ocultar explicaci√≥n">?</button>
                        </div>
                        <select id="kdpPaper">
                            <option value="white">Blanco</option>
                            <option value="cream">Crema</option>
                        </select>
                        <div class="info-details" id="info-kdpPaper" hidden>
                            <p><strong>Tipo de Papel:</strong> KDP ofrece principalmente dos tipos para impresi√≥n en blanco y negro.</p>
                            <ul>
                                <li><strong>Blanco:</strong> Papel m√°s brillante, com√∫n en libros de no ficci√≥n.</li>
                                <li><strong>Crema:</strong> Tono m√°s c√°lido, preferido para novelas, cansa menos la vista.</li>
                            </ul>
                             <p>El papel para impresi√≥n a color es diferente y viene determinado por el tipo de tinta (Est√°ndar o Premium).</p>
                        </div>
                    </div>

                     <div class="input-group">
                         <div class="label-group">
                             <label for="kdpTrim">Tama√±o (Trim Size):</label>
                             <button class="info-toggle" aria-expanded="false" aria-controls="info-kdpTrim" title="Mostrar/Ocultar explicaci√≥n">?</button>
                        </div>
                        <select id="kdpTrim">
                            <option value="6x9">6x9 pulgadas (aprox. 15x23 cm)</option>
                            <option value="5x8">5x8 pulgadas (aprox. 13x20 cm)</option>
                            <option value="5.5x8.5">5.5x8.5 pulgadas (aprox. 14x22 cm)</option>
                            <option value="8.5x11">8.5x11 pulgadas (aprox. 22x28 cm - A4)</option>
                            <!-- A√±adir m√°s opciones si es necesario -->
                        </select>
                         <div class="info-details" id="info-kdpTrim" hidden>
                            <p><strong>Tama√±o (Trim Size):</strong> Las dimensiones f√≠sicas de tu libro (ancho x alto). KDP ofrece varios tama√±os est√°ndar.</p>
                            <p>La elecci√≥n depende del g√©nero y las convenciones del mercado. El tama√±o puede afectar ligeramente el coste de impresi√≥n.</p>
                        </div>
                    </div>

                    <div class="input-group">
                        <div class="label-group">
                            <label for="kdpDistribution">Distribuci√≥n:</label>
                            <button class="info-toggle" aria-expanded="false" aria-controls="info-kdpDistribution" title="Mostrar/Ocultar explicaci√≥n">?</button>
                        </div>
                        <select id="kdpDistribution">
                            <option value="standard">Est√°ndar</option>
                            <option value="expanded">Expandida</option>
                        </select>
                        <div class="info-details" id="info-kdpDistribution" hidden>
                            <p><strong>Distribuci√≥n:</strong> Define d√≥nde estar√° disponible tu libro impreso.</p>
                             <ul>
                                <li><strong>Est√°ndar:</strong> Venta solo en las tiendas Amazon del marketplace donde publicas (y otros marketplaces de Amazon seleccionados). Ofrece un royalty del 60% (antes de costes de impresi√≥n).</li>
                                <li><strong>Expandida:</strong> Permite que tu libro est√© disponible para distribuidores externos, librer√≠as online y f√≠sicas (principalmente en USA, UK). El royalty baja al 40% (antes de costes de impresi√≥n) y no todos los libros son elegibles.</li>
                            </ul>
                        </div>
                    </div>

                    <div class="input-group">
                         <div class="label-group">
                             <label for="kdpRoyaltyPrint">Royalty Print (% Base):</label>
                             <button class="info-toggle" aria-expanded="false" aria-controls="info-kdpRoyaltyPrint" title="Mostrar/Ocultar explicaci√≥n">?</button>
                         </div>
                         <input type="number" id="kdpRoyaltyPrint" value="60" step="1" min="0" max="100" readonly>
                         <div class="info-details" id="info-kdpRoyaltyPrint" hidden>
                            <p><strong>Royalty Print (% Base):</strong> Es el porcentaje del precio de venta que KDP usa como base para calcular tu beneficio. Se aplica <strong>antes</strong> de restar el coste de impresi√≥n.</p>
                            <p>Este campo se actualiza autom√°ticamente: <strong>60%</strong> para Distribuci√≥n Est√°ndar y <strong>40%</strong> para Distribuci√≥n Expandida.</p>
                             <p><strong>Tu royalty real por libro = (Precio Venta * % Base) - Coste Impresi√≥n.</strong></p>
                        </div>
                    </div>
                </fieldset>

                <fieldset>
                     <legend>Detalles del Libro (eBook)</legend>

                     <div class="input-group">
                         <div class="label-group">
                             <label for="kdpListPriceEbook">Precio de Venta (eBook) (‚Ç¨):</label>
                             <button class="info-toggle" aria-expanded="false" aria-controls="info-kdpListPriceEbook" title="Mostrar/Ocultar explicaci√≥n">?</button>
                        </div>
                        <input type="number" id="kdpListPriceEbook" value="4.99" step="0.01" min="0">
                        <div class="info-details" id="info-kdpListPriceEbook" hidden>
                            <p><strong>Precio de Venta (eBook):</strong> El precio que pagar√° el cliente por la versi√≥n digital (Kindle) de tu libro en Amazon.</p>
                             <p>El precio que elijas (junto con el marketplace) determinar√° si puedes optar por el royalty del 35% o del 70%.</p>
                        </div>
                    </div>

                     <div class="input-group">
                         <div class="label-group">
                             <label for="kdpRoyaltyEbook">Opci√≥n de Royalty eBook (%):</label>
                             <button class="info-toggle" aria-expanded="false" aria-controls="info-kdpRoyaltyEbook" title="Mostrar/Ocultar explicaci√≥n">?</button>
                         </div>
                        <select id="kdpRoyaltyEbook">
                            <option value="70">70%</option>
                            <option value="35">35%</option>
                        </select>
                         <div class="info-details" id="info-kdpRoyaltyEbook" hidden>
                            <p><strong>Opci√≥n de Royalty eBook:</strong> KDP ofrece dos opciones principales:</p>
                            <ul>
                                <li><strong>70%:</strong> Disponible para precios entre 2.99‚Ç¨ y 9.99‚Ç¨ (en la mayor√≠a de marketplaces). Se aplican "costes de entrega" (delivery fees) basados en el tama√±o del archivo del eBook, que se restan de tu royalty.</li>
                                <li><strong>35%:</strong> Disponible para precios fuera del rango 2.99‚Ç¨-9.99‚Ç¨, o si eliges esta opci√≥n voluntariamente. No se aplican costes de entrega.</li>
                            </ul>
                             <p>La elecci√≥n √≥ptima depende de tu precio y del tama√±o del archivo.</p>
                        </div>
                    </div>

                    <div class="input-group">
                        <div class="label-group">
                            <label for="kdpEbookSize">Tama√±o archivo eBook (MB):</label>
                             <button class="info-toggle" aria-expanded="false" aria-controls="info-kdpEbookSize" title="Mostrar/Ocultar explicaci√≥n">?</button>
                         </div>
                        <input type="number" id="kdpEbookSize" value="5" step="0.1" min="0.1">
                         <div class="info-details" id="info-kdpEbookSize" hidden>
                            <p><strong>Tama√±o archivo eBook (MB):</strong> El tama√±o en Megabytes de tu archivo final de eBook (generalmente .kpf o .epub subido a KDP).</p>
                             <p>Este tama√±o se usa para calcular los <strong>costes de entrega</strong> si eliges la opci√≥n de royalty del 70%. En marketplaces como Amazon.es, el coste es aprox. 0.15‚Ç¨ por MB.</p>
                             <p>Un libro de solo texto suele ser peque√±o (1-3 MB), pero si incluye muchas im√°genes, puede ser significativamente mayor.</p>
                        </div>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>Ventas Estimadas (KDP)</legend>

                    <div class="input-group">
                        <div class="label-group">
                            <label for="kdpSalesPrint">Unidades Impresas Vendidas:</label>
                            <button class="info-toggle" aria-expanded="false" aria-controls="info-kdpSalesPrint" title="Mostrar/Ocultar explicaci√≥n">?</button>
                         </div>
                        <input type="number" id="kdpSalesPrint" value="100" min="0">
                         <div class="info-details" id="info-kdpSalesPrint" hidden>
                            <p><strong>Unidades Impresas Vendidas:</strong> Tu estimaci√≥n de cu√°ntos ejemplares f√≠sicos esperas vender a trav√©s de KDP en un per√≠odo determinado (ej. un a√±o). Se usa para proyectar ingresos y beneficios.</p>
                        </div>
                    </div>

                    <div class="input-group">
                        <div class="label-group">
                            <label for="kdpSalesEbook">Unidades eBook Vendidas:</label>
                            <button class="info-toggle" aria-expanded="false" aria-controls="info-kdpSalesEbook" title="Mostrar/Ocultar explicaci√≥n">?</button>
                        </div>
                        <input type="number" id="kdpSalesEbook" value="200" min="0">
                        <div class="info-details" id="info-kdpSalesEbook" hidden>
                            <p><strong>Unidades eBook Vendidas:</strong> Tu estimaci√≥n de cu√°ntos ejemplares digitales (Kindle) esperas vender a trav√©s de KDP en el mismo per√≠odo. Se usa para proyectar ingresos y beneficios.</p>
                        </div>
                    </div>
                </fieldset>

            </div>

            <!-- Secci√≥n Imprenta Tradicional -->
            <div id="traditionalSection" class="mode-section hidden">
                <h2>Imprenta Tradicional</h2>

                <fieldset>
                    <legend>Costes de Impresi√≥n y Distribuci√≥n</legend>

                     <div class="input-group">
                         <div class="label-group">
                             <label for="tradListPrice">Precio de Venta (‚Ç¨):</label>
                             <button class="info-toggle" aria-expanded="false" aria-controls="info-tradListPrice" title="Mostrar/Ocultar explicaci√≥n">?</button>
                         </div>
                        <input type="number" id="tradListPrice" value="18.00" step="0.01" min="0">
                         <div class="info-details" id="info-tradListPrice" hidden>
                            <p><strong>Precio de Venta (‚Ç¨):</strong> El Precio de Venta al P√∫blico (PVP) que estableces para tu libro. Este es el precio que pagar√° el cliente final si compra directamente o en librer√≠as (aunque las librer√≠as aplicar√°n descuentos al comprarte a ti).</p>
                        </div>
                    </div>

                    <div class="input-group">
                        <div class="label-group">
                            <label for="tradPrintRun">Tirada (Cantidad Impresa):</label>
                            <button class="info-toggle" aria-expanded="false" aria-controls="info-tradPrintRun" title="Mostrar/Ocultar explicaci√≥n">?</button>
                        </div>
                        <input type="number" id="tradPrintRun" value="500" min="1">
                         <div class="info-details" id="info-tradPrintRun" hidden>
                            <p><strong>Tirada (Cantidad Impresa):</strong> El n√∫mero total de ejemplares que encargas imprimir a la imprenta. Una tirada mayor suele reducir el coste por unidad, pero aumenta la inversi√≥n inicial y el riesgo de inventario no vendido.</p>
                        </div>
                    </div>

                    <div class="input-group">
                         <div class="label-group">
                            <label for="tradCostPerUnit">Coste Unitario de Impresi√≥n (‚Ç¨):</label>
                             <button class="info-toggle" aria-expanded="false" aria-controls="info-tradCostPerUnit" title="Mostrar/Ocultar explicaci√≥n">?</button>
                        </div>
                        <input type="number" id="tradCostPerUnit" value="4.50" step="0.01" min="0">
                         <div class="info-details" id="info-tradCostPerUnit" hidden>
                            <p><strong>Coste Unitario de Impresi√≥n (‚Ç¨):</strong> El coste que te cobra la imprenta por cada libro individual impreso y entregado en tu almac√©n o domicilio. Este coste depende de la tirada, n√∫mero de p√°ginas, tipo de papel, tinta, encuadernaci√≥n, acabados y el transporte desde la imprenta.</p>
                             <p>Pide presupuestos detallados a varias imprentas.</p>
                        </div>
                    </div>

                    <div class="input-group">
                         <div class="label-group">
                             <label for="tradShippingCustomer">Coste Env√≠o por Venta (‚Ç¨):</label>
                             <button class="info-toggle" aria-expanded="false" aria-controls="info-tradShippingCustomer" title="Mostrar/Ocultar explicaci√≥n">?</button>
                        </div>
                        <input type="number" id="tradShippingCustomer" value="3.00" step="0.01" min="0">
                         <div class="info-details" id="info-tradShippingCustomer" hidden>
                            <p><strong>Coste Env√≠o por Venta (‚Ç¨):</strong> El coste medio que te supone enviar un libro <strong>vendido</strong> al cliente final o a un distribuidor/librer√≠a. Incluye el embalaje y la tarifa postal o de mensajer√≠a.</p>
                             <p>Este es un coste variable que solo se aplica a las unidades vendidas.</p>
                        </div>
                    </div>

                     <div class="input-group">
                        <div class="label-group">
                            <label for="tradSales">Unidades Vendidas Estimadas:</label>
                            <button class="info-toggle" aria-expanded="false" aria-controls="info-tradSales" title="Mostrar/Ocultar explicaci√≥n">?</button>
                        </div>
                        <input type="number" id="tradSales" value="100" min="0">
                        <div class="info-details" id="info-tradSales" hidden>
                            <p><strong>Unidades Vendidas Estimadas:</strong> Tu estimaci√≥n de cu√°ntos ejemplares de la tirada impresa esperas vender directamente o a trav√©s de distribuidores/librer√≠as en un per√≠odo determinado.</p>
                             <p>Este n√∫mero no puede ser mayor que la tirada impresa.</p>
                        </div>
                    </div>
                </fieldset>

                 <fieldset>
                    <legend>Inventario (Calculado)</legend>
                    <div class="input-group readonly-display">
                        <p><strong>Coste Total de la Tirada:</strong> <span id="tradTotalPrintRunCost">‚Ç¨0.00</span></p>
                        <p><strong>Unidades en Inventario (no vendidas):</strong> <span id="tradInventoryUnits">0</span></p>
                        <p><strong>Valor del Inventario (a coste):</strong> <span id="tradInventoryValue">‚Ç¨0.00</span></p>
                         <div class="info-details" id="info-inventory" hidden> <!-- Link this manually if needed, or just keep general -->
                            <p>Esta secci√≥n muestra c√°lculos basados en la Tirada, Coste Unitario y Ventas:</p>
                            <ul>
                                <li><strong>Coste Total Tirada:</strong> Inversi√≥n inicial en la impresi√≥n (Tirada * Coste Unitario).</li>
                                <li><strong>Unidades en Inventario:</strong> Libros impresos que a√∫n no se han vendido (Tirada - Ventas).</li>
                                <li><strong>Valor del Inventario:</strong> Coste de los libros no vendidos (Unidades Inventario * Coste Unitario). Representa capital inmovilizado.</li>
                            </ul>
                        </div>
                    </div>
                 </fieldset>
            </div>

            <!-- Secci√≥n de Costes Comunes -->
            <div class="common-costs">
                <h2>Costes Fijos Comunes (Ambos Modos)</h2>
                <fieldset>

                    <div class="input-group">
                        <div class="label-group">
                            <label for="editingCost">Coste de Edici√≥n (‚Ç¨):</label>
                            <button class="info-toggle" aria-expanded="false" aria-controls="info-editingCost" title="Mostrar/Ocultar explicaci√≥n">?</button>
                        </div>
                        <input type="number" id="editingCost" value="500" step="0.01" min="0">
                        <div class="info-details" id="info-editingCost" hidden>
                            <p><strong>Coste de Edici√≥n:</strong> Incluye la revisi√≥n profesional del manuscrito para corregir errores gramaticales, de estilo, coherencia y estructura. Puede incluir edici√≥n de desarrollo, de l√≠nea y/o correcci√≥n de pruebas (proofreading). Es un coste crucial para la calidad del libro.</p>
                        </div>
                    </div>

                    <div class="input-group">
                         <div class="label-group">
                             <label for="coverCost">Coste Dise√±o de Cubierta (‚Ç¨):</label>
                             <button class="info-toggle" aria-expanded="false" aria-controls="info-coverCost" title="Mostrar/Ocultar explicaci√≥n">?</button>
                        </div>
                        <input type="number" id="coverCost" value="250" step="0.01" min="0">
                        <div class="info-details" id="info-coverCost" hidden>
                            <p><strong>Coste Dise√±o de Cubierta:</strong> Inversi√≥n en un dise√±ador gr√°fico profesional para crear una portada atractiva y comercial, tanto para el eBook como para la versi√≥n impresa. La portada es una herramienta de marketing fundamental.</p>
                        </div>
                    </div>

                    <div class="input-group">
                        <div class="label-group">
                             <label for="formattingCost">Coste Maquetaci√≥n (‚Ç¨):</label>
                             <button class="info-toggle" aria-expanded="false" aria-controls="info-formattingCost" title="Mostrar/Ocultar explicaci√≥n">?</button>
                        </div>
                        <input type="number" id="formattingCost" value="150" step="0.01" min="0">
                         <div class="info-details" id="info-formattingCost" hidden>
                            <p><strong>Coste Maquetaci√≥n:</strong> Coste de dar formato profesional al interior del libro, tanto para la versi√≥n digital (eBook, .epub, .mobi) como para la versi√≥n impresa (PDF listo para imprenta). Una buena maquetaci√≥n mejora la legibilidad y la experiencia del lector.</p>
                        </div>
                    </div>

                    <div class="input-group">
                        <div class="label-group">
                             <label for="isbnCost">Coste de ISBN(s) (‚Ç¨):</label>
                             <button class="info-toggle" aria-expanded="false" aria-controls="info-isbnCost" title="Mostrar/Ocultar explicaci√≥n">?</button>
                         </div>
                        <input type="number" id="isbnCost" value="0" step="0.01" min="0">
                        <div class="info-details" id="info-isbnCost" hidden>
                            <p><strong>Coste de ISBN(s):</strong> El ISBN (International Standard Book Number) es un identificador √∫nico para tu libro.</p>
                            <ul>
                                <li><strong>KDP:</strong> Ofrece un ISBN gratuito para libros impresos, pero solo es v√°lido dentro de la plataforma de Amazon. No ofrece ISBN para eBooks.</li>
                                <li><strong>Impr. Tradicional / Distribuci√≥n Amplia:</strong> Necesitar√°s comprar tus propios ISBNs (uno para cada formato: tapa blanda, tapa dura, eBook) si quieres figurar como la editorial y distribuir fuera de KDP. En Espa√±a, se gestionan a trav√©s de la Agencia del ISBN.</li>
                            </ul>
                             <p>Introduce aqu√≠ el coste total si has comprado ISBNs propios.</p>
                        </div>
                    </div>

                    <div class="input-group">
                         <div class="label-group">
                            <label for="marketingCost">Coste Marketing/Publicidad (‚Ç¨):</label>
                            <button class="info-toggle" aria-expanded="false" aria-controls="info-marketingCost" title="Mostrar/Ocultar explicaci√≥n">?</button>
                         </div>
                        <input type="number" id="marketingCost" value="100" step="0.01" min="0">
                         <div class="info-details" id="info-marketingCost" hidden>
                            <p><strong>Coste Marketing/Publicidad:</strong> Presupuesto total destinado a promocionar tu libro. Puede incluir publicidad en Amazon Ads, Facebook Ads, creaci√≥n de material promocional (marcadores, web), env√≠os a blogueros, etc.</p>
                        </div>
                    </div>

                     <div class="input-group">
                         <div class="label-group">
                            <label for="otherCost">Otros Costes Fijos (‚Ç¨):</label>
                            <button class="info-toggle" aria-expanded="false" aria-controls="info-otherCost" title="Mostrar/Ocultar explicaci√≥n">?</button>
                        </div>
                        <input type="number" id="otherCost" value="50" step="0.01" min="0">
                        <div class="info-details" id="info-otherCost" hidden>
                            <p><strong>Otros Costes Fijos:</strong> Un caj√≥n de sastre para cualquier otro gasto inicial no cubierto anteriormente. Ejemplos: compra de software espec√≠fico, tarifas de registro de autor, coste de copias de prueba (author copies), ilustraciones internas, etc.</p>
                        </div>
                    </div>
                </fieldset>
            </div>
        </div>

        <button id="calculateBtn">Calcular Resultados</button>

        <div id="results" class="results-section">
            <h2>üìä Resultados</h2>
            <p>Introduce los datos y pulsa Calcular, o modifica cualquier valor para actualizar los resultados.</p>
        </div>
    </div>

    <!-- Script JavaScript Incrustado -->
    <script>
        // --- Funciones de C√°lculo (sin cambios importantes) ---
        function getNumValue(id) { /* ... (igual que antes) ... */
            const element = document.getElementById(id);
            if (!element) { console.error(`Element with ID ${id} not found.`); return 0; }
            const value = element.value;
            // Treat empty string as 0, otherwise parse
            return value === '' ? 0 : (parseFloat(value) || 0);
        }

        function estimateKdpPrintCost(pages, inkType, paperType, trimSize, distribution) { /* ... (igual que antes) ... */
            let fixedCost = 0; let perPageCost = 0;
            // Example costs for amazon.es (Check official KDP calculator!)
            if (inkType === 'bw') { fixedCost = 0.60; perPageCost = 0.012; }
            else if (inkType === 'color_standard') { if (pages <= 40) { fixedCost = 0.70; perPageCost = 0.05; } else { fixedCost = 0.70; perPageCost = 0.04; } }
            else if (inkType === 'color_premium') { fixedCost = 0.70; perPageCost = 0.07; }
            let royaltyRate = (distribution === 'expanded') ? 0.40 : 0.60;
            if (pages < 24) return { cost: 0, royaltyRate: royaltyRate };
            let totalCost = fixedCost + (pages * perPageCost);
            return { cost: Math.round(totalCost * 100) / 100, royaltyRate: royaltyRate };
        }

        function calculateKdpEbookDeliveryFee(royaltyRatePercent, ebookSizeMB) { /* ... (igual que antes) ... */
             if (royaltyRatePercent === 70 && ebookSizeMB > 0) {
                 const feePerMB = 0.15; // Example for EUR/ES
                 return feePerMB * ebookSizeMB;
             } return 0;
        }

        // --- Funci√≥n Principal de C√°lculo (adaptada ligeramente para claridad) ---
        function calculateCosts() {
            const mode = document.getElementById('modeSelect').value;
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<h2>üìä Resultados</h2>'; // Clear previous results but keep header

            // --- Variables de C√°lculo (igual que antes) ---
             let totalFixedCosts = 0;
             let totalVariableCostsPerUnitSold = 0;
             let totalRevenue = 0;
             let estimatedUnitsSold = 0;
             let averageUnitCost = 0; // Average variable cost per unit *sold*
             let breakEvenUnits = 0;
             let profitPerUnitSold = 0; // Average profit per unit *sold*
             let additionalInfo = '';

            // --- Recolecci√≥n de Datos (igual que antes) ---
            totalFixedCosts = getNumValue('editingCost') + getNumValue('coverCost') + getNumValue('formattingCost') + getNumValue('isbnCost') + getNumValue('marketingCost') + getNumValue('otherCost');

            // --- C√°lculos por Modo (igual que antes, con peque√±os ajustes de texto) ---
            if (mode === 'kdp') {
                 // KDP Inputs
                const kdpListPricePrint = getNumValue('kdpListPricePrint');
                const kdpListPriceEbook = getNumValue('kdpListPriceEbook');
                const kdpPages = getNumValue('kdpPages');
                const kdpInk = document.getElementById('kdpInk').value;
                const kdpPaper = document.getElementById('kdpPaper').value;
                const kdpTrim = document.getElementById('kdpTrim').value;
                const kdpDistribution = document.getElementById('kdpDistribution').value;
                const kdpRoyaltyEbookPercent = getNumValue('kdpRoyaltyEbook');
                const kdpEbookSize = getNumValue('kdpEbookSize');
                const kdpSalesPrint = getNumValue('kdpSalesPrint');
                const kdpSalesEbook = getNumValue('kdpSalesEbook');

                estimatedUnitsSold = kdpSalesPrint + kdpSalesEbook;

                let totalPrintRevenue = 0, totalPrintVariableCosts = 0, printCostPerUnit = 0, printRoyaltyPerUnit = 0;
                if (kdpSalesPrint > 0 && kdpListPricePrint > 0 && kdpPages >= 24) {
                    const printCostResult = estimateKdpPrintCost(kdpPages, kdpInk, kdpPaper, kdpTrim, kdpDistribution);
                    printCostPerUnit = printCostResult.cost;
                    const printRoyaltyRate = printCostResult.royaltyRate;
                    printRoyaltyPerUnit = Math.max(0, (printRoyaltyRate * kdpListPricePrint) - printCostPerUnit);
                    totalPrintRevenue = printRoyaltyPerUnit * kdpSalesPrint;
                    totalPrintVariableCosts = printCostPerUnit * kdpSalesPrint;
                }

                let totalEbookRevenue = 0, totalEbookVariableCosts = 0, ebookDeliveryFeePerUnit = 0, ebookRoyaltyPerUnit = 0;
                if (kdpSalesEbook > 0 && kdpListPriceEbook > 0) {
                    ebookDeliveryFeePerUnit = calculateKdpEbookDeliveryFee(kdpRoyaltyEbookPercent, kdpEbookSize);
                    const ebookRoyaltyRate = kdpRoyaltyEbookPercent / 100;
                    ebookRoyaltyPerUnit = Math.max(0, (ebookRoyaltyRate * kdpListPriceEbook) - ebookDeliveryFeePerUnit);
                    totalEbookRevenue = ebookRoyaltyPerUnit * kdpSalesEbook;
                    totalEbookVariableCosts = ebookDeliveryFeePerUnit * kdpSalesEbook;
                }

                totalRevenue = totalPrintRevenue + totalEbookRevenue; // Total income received
                totalVariableCostsPerUnitSold = totalPrintVariableCosts + totalEbookVariableCosts; // Total CoGS

                if (estimatedUnitsSold > 0) {
                    averageUnitCost = totalVariableCostsPerUnitSold / estimatedUnitsSold;
                    const averageRoyaltyPerUnit = totalRevenue / estimatedUnitsSold; // Use actual average royalty for BEP
                     if (averageRoyaltyPerUnit > 0) {
                         breakEvenUnits = totalFixedCosts / averageRoyaltyPerUnit;
                     } else if (totalFixedCosts > 0) { breakEvenUnits = Infinity; }
                     // Profit per unit sold = Avg Royalty per Unit - (Total Fixed Costs / Total Units Sold)
                     profitPerUnitSold = averageRoyaltyPerUnit - (totalFixedCosts / estimatedUnitsSold);

                    additionalInfo = `
                        <p><strong>Detalles KDP Print:</strong> Coste Impresi√≥n/ud: ‚Ç¨${printCostPerUnit.toFixed(2)}, Royalty Neto/ud: ‚Ç¨${printRoyaltyPerUnit.toFixed(2)}</p>
                        <p><strong>Detalles KDP eBook:</strong> Coste Entrega/ud: ‚Ç¨${ebookDeliveryFeePerUnit.toFixed(2)}, Royalty Neto/ud: ‚Ç¨${ebookRoyaltyPerUnit.toFixed(2)}</p>
                        <p><strong>Royalty Total Neto Estimado (Ingresos):</strong> ‚Ç¨${totalRevenue.toFixed(2)}</p>
                    `;
                } else { /* ... handling for zero sales ... */
                     averageUnitCost = 0; profitPerUnitSold = 0;
                     breakEvenUnits = (totalFixedCosts > 0) ? Infinity : 0;
                 }

            } else if (mode === 'traditional') {
                 // Traditional Inputs
                const tradListPrice = getNumValue('tradListPrice');
                const tradPrintRun = getNumValue('tradPrintRun');
                const tradCostPerUnitPrinted = getNumValue('tradCostPerUnit');
                const tradShippingCustomer = getNumValue('tradShippingCustomer');
                const tradSales = getNumValue('tradSales');

                estimatedUnitsSold = Math.min(tradSales, tradPrintRun); // Cannot sell more than printed

                 // Calculate inventory first for display
                const totalPrintRunCost = tradCostPerUnitPrinted * tradPrintRun;
                const inventoryUnits = Math.max(0, tradPrintRun - estimatedUnitsSold);
                const inventoryValue = inventoryUnits * tradCostPerUnitPrinted;

                document.getElementById('tradTotalPrintRunCost').textContent = `‚Ç¨${totalPrintRunCost.toFixed(2)}`;
                document.getElementById('tradInventoryUnits').textContent = inventoryUnits.toFixed(0);
                document.getElementById('tradInventoryValue').textContent = `‚Ç¨${inventoryValue.toFixed(2)}`;

                if (estimatedUnitsSold > 0) {
                    totalRevenue = tradListPrice * estimatedUnitsSold;
                    averageUnitCost = tradCostPerUnitPrinted + tradShippingCustomer; // Variable cost per unit *sold*
                    totalVariableCostsPerUnitSold = averageUnitCost * estimatedUnitsSold;
                    const profitPerSoldUnitBeforeFixed = tradListPrice - averageUnitCost;
                     if (profitPerSoldUnitBeforeFixed > 0) {
                         breakEvenUnits = totalFixedCosts / profitPerSoldUnitBeforeFixed;
                     } else if (totalFixedCosts > 0) { breakEvenUnits = Infinity; }
                    // Profit per unit sold = Profit Before Fixed - (Total Fixed Costs / Units Sold)
                    profitPerUnitSold = profitPerSoldUnitBeforeFixed - (totalFixedCosts / estimatedUnitsSold);

                } else { /* ... handling for zero sales ... */
                     totalRevenue = 0; totalVariableCostsPerUnitSold = 0;
                     averageUnitCost = tradCostPerUnitPrinted + tradShippingCustomer;
                     profitPerUnitSold = 0;
                     const profitPerSoldUnitBeforeFixed = tradListPrice - averageUnitCost;
                     if (profitPerSoldUnitBeforeFixed > 0 && totalFixedCosts > 0) { breakEvenUnits = totalFixedCosts / profitPerSoldUnitBeforeFixed;}
                     else if (totalFixedCosts > 0) { breakEvenUnits = Infinity; }
                     else { breakEvenUnits = 0; }
                 }

                additionalInfo = `
                    <p><strong>Coste Total Tirada (Inversi√≥n Inicial):</strong> ‚Ç¨${totalPrintRunCost.toFixed(2)} (${tradPrintRun} unidades)</p>
                    <p><strong>Coste Variable por Unidad Vendida:</strong> ‚Ç¨${averageUnitCost.toFixed(2)} (Imprenta: ${tradCostPerUnitPrinted.toFixed(2)} + Env√≠o: ${tradShippingCustomer.toFixed(2)})</p>
                    <p><strong>Beneficio Bruto por Unidad Vendida (Antes de Fijos):</strong> ‚Ç¨${(tradListPrice - averageUnitCost).toFixed(2)}</p>
                    <p><strong>Inventario Restante:</strong> ${inventoryUnits} unidades (Valor a coste: ‚Ç¨${inventoryValue.toFixed(2)})</p>
                `;
            }

            // --- C√°lculo de M√©tricas Finales (igual que antes) ---
            const totalCosts = totalFixedCosts + totalVariableCostsPerUnitSold;
            const totalProfit = totalRevenue - totalCosts;
            const profitMargin = totalRevenue > 0 ? (totalProfit / totalRevenue) * 100 : 0;

            // --- Visualizaci√≥n de Resultados (igual que antes) ---
            let resultsHTML = `
                <h2>üìä Resultados Finales</h2>
                <p><strong>Unidades Vendidas Estimadas:</strong> ${estimatedUnitsSold.toFixed(0)}</p>
                <p><strong>Costes Fijos Totales:</strong> ‚Ç¨${totalFixedCosts.toFixed(2)}</p>
                <p><strong>Costes Variables Totales (para unidades vendidas):</strong> ‚Ç¨${totalVariableCostsPerUnitSold.toFixed(2)}</p>
                <p><strong>Coste Variable Medio por Unidad Vendida:</strong> ‚Ç¨${averageUnitCost.toFixed(2)}</p>
                <p><strong>Costes Totales (Fijos + Variables de Ventas):</strong> ‚Ç¨${totalCosts.toFixed(2)}</p>
                <p><strong>Ingresos Totales Brutos (Trad) / Royalty Neto (KDP):</strong> ‚Ç¨${totalRevenue.toFixed(2)}</p>
                <p><strong>Beneficio Neto Total Estimado:</strong> <strong style="font-size: 1.1em; color: ${totalProfit >= 0 ? '#27ae60' : '#c0392b'};">‚Ç¨${totalProfit.toFixed(2)}</strong></p>
                <p><strong>Beneficio Neto Medio por Unidad Vendida:</strong> ‚Ç¨${profitPerUnitSold.toFixed(2)}</p>
                <p><strong>Margen de Beneficio Neto:</strong> ${profitMargin.toFixed(2)}%</p>
                <p><strong>Punto de Equilibrio (Unidades a vender para cubrir costes fijos):</strong> ${isFinite(breakEvenUnits) ? Math.ceil(breakEvenUnits).toFixed(0) : 'Inalcanzable con estos datos'}</p>
                <hr>
                <h3>Detalles Adicionales (${mode === 'kdp' ? 'KDP' : 'Imprenta Tradicional'}):</h3>
                ${additionalInfo}
            `;
            resultsDiv.innerHTML = resultsHTML;
        }


        // --- Funciones de UI (Modificadas para manejar los toggles) ---

        function toggleModeSections() {
             // ... (igual que antes, gestionando visibilidad de secciones y texto ISBN) ...
            const mode = document.getElementById('modeSelect').value;
            const kdpSection = document.getElementById('kdpSection');
            const traditionalSection = document.getElementById('traditionalSection');
            const isbnInput = document.getElementById('isbnCost');
            const isbnInfoDetails = document.getElementById('info-isbnCost'); // Target the explanation div
            const isbnInfoButton = isbnInfoDetails.previousElementSibling.querySelector('.info-toggle'); // Find the button

            if (mode === 'kdp') {
                kdpSection.classList.remove('hidden');
                traditionalSection.classList.add('hidden');
                if (isbnInput.value === '' || parseFloat(isbnInput.value) === 0) { // Only set to 0 if it was empty or 0 before
                     isbnInput.value = "0";
                }
                 // Update explanation text dynamically if needed, or keep it general
                 // Example: isbnInfoDetails.querySelector('p').innerHTML = "<strong>Coste de ISBN(s):</strong> KDP ofrece uno gratis...";
            } else {
                kdpSection.classList.add('hidden');
                traditionalSection.classList.remove('hidden');
                 // Example: isbnInfoDetails.querySelector('p').innerHTML = "<strong>Coste de ISBN(s):</strong> Imprenta tradicional requiere comprar...";
            }
            // Recalculate when mode changes
             calculateCosts();
        }

        function updateKdpPrintRoyaltyDisplay() {
             // ... (igual que antes) ...
             const distribution = document.getElementById('kdpDistribution').value;
             const royaltyInput = document.getElementById('kdpRoyaltyPrint');
             royaltyInput.value = (distribution === 'expanded') ? 40 : 60;
        }

        // --- NUEVO: Manejador para los botones de informaci√≥n ---
        function handleInfoToggle(event) {
            const button = event.target.closest('.info-toggle');
            if (!button) return; // Exit if click wasn't on a toggle button

            const isExpanded = button.getAttribute('aria-expanded') === 'true';
            const detailsId = button.getAttribute('aria-controls');
            const detailsPanel = document.getElementById(detailsId);

            if (detailsPanel) {
                button.setAttribute('aria-expanded', !isExpanded);
                detailsPanel.hidden = !detailsPanel.hidden; // Toggle visibility
            }
        }

        // --- Event Listeners ---
        document.getElementById('calculateBtn').addEventListener('click', calculateCosts);
        document.getElementById('modeSelect').addEventListener('change', toggleModeSections);
        document.getElementById('kdpDistribution').addEventListener('change', () => {
            updateKdpPrintRoyaltyDisplay();
            calculateCosts(); // Recalculate if distribution change affects royalty/costs
        });

        // Add listeners to all inputs/selects for live calculation
        const inputs = document.querySelectorAll('input[type="number"], select');
        inputs.forEach(input => {
            // Recalculate on change (when focus is lost) or keyup (as typing)
            input.addEventListener('change', calculateCosts);
            input.addEventListener('keyup', calculateCosts);
        });

        // Add delegated event listener for all info toggle buttons
        document.addEventListener('click', handleInfoToggle);


        // --- Initial Setup ---
        updateKdpPrintRoyaltyDisplay();
        toggleModeSections(); // Sets initial visibility and runs first calculation
        // calculateCosts(); // Already called within toggleModeSections

    </script>
    <!-- Fin de Script JavaScript -->

</body>
</html>